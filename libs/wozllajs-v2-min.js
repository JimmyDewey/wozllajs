define("var/isArray",[],function(){var e=Object.prototype.toString;return function(t){return e.call(t)==="[object Array]"}}),define("var/isImage",[],function(){var e=Object.prototype.toString;return function(t){var n=e.call(t);return n==="[object Image]"||n==="[object HTMLImageElement]"}}),define("var/extend",[],function(){return function(e,t){var n,r=e.prototype,i=Object.create(t.prototype);for(n in r)r.hasOwnProperty(n)&&(i[n]=r[n]);e.prototype=i}}),define("var/uniqueKey",[],function(){var e=1;return function(){return e++}}),define("var/slice",[],function(){return function(e){var t=Array.prototype.slice.apply(arguments,[1]);return Array.prototype.slice.apply(e,t)}}),define("var/createCanvas",[],function(){return function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n}}),define("var/support",[],function(){return{touch:"ontouchstart"in window}}),define("globals",[],function(){return{METHOD_UPDATE:"update",METHOD_LATE_UPDATE:"lateUpdate",METHOD_DRAW:"draw",METHOD_INIT_COMPONENT:"initComponent",METHOD_DESTROY_COMPONENT:"destroyComponent"}}),define("var",["./var/isArray","./var/isImage","./var/extend","./var/uniqueKey","./var/slice","./var/createCanvas","./var/support","./globals"],function(e,t,n,r,i,s,o,u){var a={isArray:e,isImage:t,extend:n,uniqueKey:r,slice:i,createCanvas:s,support:o};for(var f in u)a[f]=u[f];return a}),define("promise",["./var"],function(e){var t=function(){this._thenQueue=[],this._errorQueue=[]};t.wait=function(n){var r,i,s=new t,o=0,u=[];arguments.length===1?e.isArray(n)||(n=[n]):n=e.slice(arguments);for(r=0,i=n.length;r<i;r++)(function(t,r){n[t].then(function(n){return o++,n=arguments.length>1?e.slice(arguments):n,u[t]=n,o===r&&s.done.apply(s,u),n})})(r,i);return s};var n=t.prototype;return n.then=function(e,t){return this._thenQueue.push({callback:e,context:t}),this},n.catchError=function(e,t){return this._errorQueue.push({callback:e,context:t}),this},n.done=function(){return this._nextThen.apply(this,arguments),this},n.sendError=function(e){return this._nextError(e),this},n._nextThen=function(){var t=this._thenQueue.shift();if(t){var n=t.callback.apply(t.context||this,arguments);n=e.isArray(n)?n:[n],this._nextThen.apply(this,n)}},n._nextError=function(){var t=this._errorQueue.shift();if(t){var n=t.callback.apply(t.context||this,arguments);n=e.isArray(n)?n:[n],this._nextError.apply(this,n)}},t}),define("math/Matrix2D",[],function(){var e=function(e,t,n,r,i,s){this.initialize(e,t,n,r,i,s)},t=e.prototype;return e.identity=null,e.DEG_TO_RAD=Math.PI/180,t.a=1,t.b=0,t.c=0,t.d=1,t.tx=0,t.ty=0,t.alpha=1,t.shadow=null,t.compositeOperation=null,t.initialize=function(e,t,n,r,i,s){return this.a=e==null?1:e,this.b=t||0,this.c=n||0,this.d=r==null?1:r,this.tx=i||0,this.ty=s||0,this},t.prepend=function(e,t,n,r,i,s){var o=this.tx;if(e!=1||t!=0||n!=0||r!=1){var u=this.a,a=this.c;this.a=u*e+this.b*n,this.b=u*t+this.b*r,this.c=a*e+this.d*n,this.d=a*t+this.d*r}return this.tx=o*e+this.ty*n+i,this.ty=o*t+this.ty*r+s,this},t.append=function(e,t,n,r,i,s){var o=this.a,u=this.b,a=this.c,f=this.d;return this.a=e*o+t*a,this.b=e*u+t*f,this.c=n*o+r*a,this.d=n*u+r*f,this.tx=i*o+s*a+this.tx,this.ty=i*u+s*f+this.ty,this},t.prependMatrix=function(e){return this.prepend(e.a,e.b,e.c,e.d,e.tx,e.ty),this.prependProperties(e.alpha,e.shadow,e.compositeOperation),this},t.appendMatrix=function(e){return this.append(e.a,e.b,e.c,e.d,e.tx,e.ty),this.appendProperties(e.alpha,e.shadow,e.compositeOperation),this},t.prependTransform=function(t,n,r,i,s,o,u,a,f){if(s%360)var l=s*e.DEG_TO_RAD,c=Math.cos(l),h=Math.sin(l);else c=1,h=0;if(a||f)this.tx-=a,this.ty-=f;return o||u?(o*=e.DEG_TO_RAD,u*=e.DEG_TO_RAD,this.prepend(c*r,h*r,-h*i,c*i,0,0),this.prepend(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),t,n)):this.prepend(c*r,h*r,-h*i,c*i,t,n),this},t.appendTransform=function(t,n,r,i,s,o,u,a,f){if(s%360)var l=s*e.DEG_TO_RAD,c=Math.cos(l),h=Math.sin(l);else c=1,h=0;o||u?(o*=e.DEG_TO_RAD,u*=e.DEG_TO_RAD,this.append(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),t,n),this.append(c*r,h*r,-h*i,c*i,0,0)):this.append(c*r,h*r,-h*i,c*i,t,n);if(a||f)this.tx-=a*this.a+f*this.c,this.ty-=a*this.b+f*this.d;return this},t.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a,i=this.c,s=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=i*t-this.d*n,this.d=i*n+this.d*t,this.tx=s*t-this.ty*n,this.ty=s*n+this.ty*t,this},t.skew=function(t,n){return t*=e.DEG_TO_RAD,n*=e.DEG_TO_RAD,this.append(Math.cos(n),Math.sin(n),-Math.sin(t),Math.cos(t),0,0),this},t.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},t.translate=function(e,t){return this.tx+=e,this.ty+=t,this},t.identity=function(){return this.alpha=this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.shadow=this.compositeOperation=null,this},t.invert=function(){var e=this.a,t=this.b,n=this.c,r=this.d,i=this.tx,s=e*r-t*n;return this.a=r/s,this.b=-t/s,this.c=-n/s,this.d=e/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(e*this.ty-t*i)/s,this},t.isIdentity=function(){return this.tx==0&&this.ty==0&&this.a==1&&this.b==0&&this.c==0&&this.d==1},t.transformPoint=function(e,t,n){return n=n||{},n.x=e*this.a+t*this.c+this.tx,n.y=e*this.b+t*this.d+this.ty,n},t.decompose=function(t){t==null&&(t={}),t.x=this.tx,t.y=this.ty,t.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),t.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var n=Math.atan2(-this.c,this.d),r=Math.atan2(this.b,this.a);return n==r?(t.rotation=r/e.DEG_TO_RAD,this.a<0&&this.d>=0&&(t.rotation+=t.rotation<=0?180:-180),t.skewX=t.skewY=0):(t.skewX=n/e.DEG_TO_RAD,t.skewY=r/e.DEG_TO_RAD),t},t.reinitialize=function(e,t,n,r,i,s,o,u,a){return this.initialize(e,t,n,r,i,s),this.alpha=o==null?1:o,this.shadow=u,this.compositeOperation=a,this},t.copy=function(e){return this.reinitialize(e.a,e.b,e.c,e.d,e.tx,e.ty,e.alpha,e.shadow,e.compositeOperation)},t.appendProperties=function(e,t,n){return this.alpha*=e,this.shadow=t||this.shadow,this.compositeOperation=n||this.compositeOperation,this},t.prependProperties=function(e,t,n){return this.alpha*=e,this.shadow=this.shadow||t,this.compositeOperation=this.compositeOperation||n,this},t.clone=function(){return(new e).copy(this)},t.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},e.identity=new e,e}),define("math/Point",[],function(){function e(e,t){this.x=e||0,this.y=t||0}return e}),define("math",["./math/Matrix2D","./math/Point"],function(e,t){return{Matrix2D:e,Point:t}}),define("ajax/param",[],function(){return{toString:function(e){if(!e)return"";var t,n="";for(t in e)n+="&"+t+"="+e[t];return n&&(n=n.substr(1)),n},toQuery:function(e){}}}),define("ajax/xhr",[],function(){return function(){return new XMLHttpRequest}}),define("ajax/get",["./param"],function(e){return function(t,n,r,i,s,o){n+="?"+e.toString(r),t.open("GET",n,o),t.setRequestHeader("Content-Type",i),t.send()}}),define("ajax/post",[],function(){return function(){}}),define("ajax/transport",["./../promise","./xhr","./get","./post"],function(e,t,n,r){return function(i){var s=new e,o,u=Date.now(),a=i.url,f=i.method||"GET",l=i.data,c=i.dataType||"text",h=i.contentType||"application/x-www-form-urlencoded; charset=UTF-8",p=i.async,d="text/plain",v="responseText",m=function(e){return e};switch(c.toLowerCase()){case"json":d="application/json",m=JSON.parse;break;case"script":case"js":d="text/javascript";break;case"xml":d="text/xml",v="responseXML"}p=p===!1?p:!0,l&&(l.t?l._=u:l.t=u),o=t(),o.overrideMimeType(d);try{switch(f.toUpperCase()){case"GET":n(o,a,l,h,c,p);break;case"POST":r(o,a,l,h,c,p);break;default:s.sendError(new Error("Unknow request method: "+f))}}catch(g){s.sendError(g)}return o.onreadystatechange=function(){var e,t;if(o.readyState===4){try{t=m(o[v])}catch(n){s.sendError(n);return}s.done(t,o)}},s}}),define("ajax",["./promise","./ajax/param","./ajax/xhr","./ajax/transport","./ajax/get","./ajax/post"],function(e,t,n,r,i,s){return{ajax:r,get:function(e,t){return r({url:e,method:"GET",data:t})},getJSON:function(e,t){return r({url:e,method:"GET",data:t,dataType:"json"})},post:function(e,t){return r({url:e,method:"POST",data:t})}}}),define("events/Event",["./../var"],function(e){var t=function(e){this.type=e.type,this.target=null,this.currentTarget=null,this.eventPhase=null,this.bubbles=e.bubbles,this._immediatePropagationStoped=!1,this._propagationStoped=!1,this._defaultPrevented=!1,this._listenerRemoved=!1};t.CAPTURING_PHASE=1,t.BUBBLING_PHASE=2,t.TARGET_PHASE=3;var n=t.prototype;return n.stopImmediatePropagation=function(){this._immediatePropagationStoped=!0,this._propagationStoped=!0},n.stopPropagation=function(){this._propagationStoped=!0},n.preventDefault=function(){this._defaultPrevented=!0},n.removeListener=function(){this._listenerRemoved=!0},t}),define("events/EventTarget",["./Event"],function(e){var t=function(){this._captureListeners={},this._listeners={}};t.DEFAULT_ACTION_MAP={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",click:"onClick"};var n=t.prototype;return n.addEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners,i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t},n.removeEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners;if(!r)return;var i=r[e];if(!i)return;for(var s=0,o=i.length;s<o;s++)if(i[s]==t){o==1?delete r[e]:i.splice(s,1);break}},n.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},n.dispatchEvent=function(n){var r,i,s,o,u;n.target=this;if(!1===n.bubbles){n.eventPhase=e.TARGET_PHASE,this._dispatchEvent(n)||(u=this[t.DEFAULT_ACTION_MAP[n.type]],u&&u(n));return}s=this._getAncients(),n.eventPhase=e.CAPTURING_PHASE;for(r=s.length-1;r>=0;r--){o=s[r],o._dispatchEvent(n)||(u=o[t.DEFAULT_ACTION_MAP[n.type]],u&&u(n));if(n._propagationStoped)return}n.eventPhase=e.TARGET_PHASE,this._dispatchEvent(n)||(u=this[t.DEFAULT_ACTION_MAP[n.type]],u&&u(n));if(n._propagationStoped)return;n.eventPhase=e.BUBBLING_PHASE;for(r=0,i=s.length;r<i;r++){o=s[r],o._dispatchEvent(n)||(u=o[t.DEFAULT_ACTION_MAP[n.type]],u&&u(n));if(n._propagationStoped)return}},n._getAncients=function(){var e=[],t=this;while(t._parent)t=t._parent,e.push(t);return e},n._dispatchEvent=function(t){var n,r,i,s,o;t.currentTarget=this,t._listenerRemoved=!1,s=t.eventPhase===e.CAPTURING_PHASE?this._captureListeners:this._listeners;if(s){i=s[t.type];if(!i||i.length===0)return t._defaultPrevented;i=i.slice();for(n=0,r=i.length;n<r;n++){t._listenerRemoved=!1,o=i[n],o(t),t._listenerRemoved&&this.removeEventListener(t.type,o,t.eventPhase===e.CAPTURING_PHASE);if(t._immediatePropagationStoped)break}}return t._defaultPrevented},t}),define("events",["./events/Event","./events/EventTarget"],function(e,t){return{Event:e,EventTarget:t}}),define("preload/Loader",["./../var"],function(e){var t=function(e){this._item=e},n=t.prototype;return n.load=function(){},t}),define("preload/ImageLoader",["require","./../var","./../promise","./Loader"],function(e,t,n,r){var i=function(){r.apply(this,arguments)};i.loadSrc=function(e){var t=new n,r=new Image;return r.src=e,r.onload=function(){t.done(r)},r.onerror=function(){t.sendError(new Error("Fail to load image, "+e))},t};var s=i.prototype;return s.load=function(){return i.loadSrc(this._item.src)},t.extend(i,r),i}),define("preload/StringLoader",["require","./../var","./../promise","./Loader"],function(e,t,n,r){var i=function(){r.apply(this,arguments)},s=i.prototype;return s.load=function(){return t.get(this._item.src)},t.extend(i,r),i}),define("preload/JSONLoader",["require","./../var","./../promise","./Loader"],function(e,t,n,r){var i=function(){r.apply(this,arguments)},s=i.prototype;return s.load=function(){return t.getJSON(this._item.src)},t.extend(i,r),i}),define("preload/LoadQueue",["require","./../var","./../promise","./ImageLoader","./StringLoader","./JSONLoader"],function(e,t,n,r,i,s){function c(e){switch(e.type){case"jpg":case"png":return new r(e);case"json":return new s(e);case"sprite":return new SpriteLoader(e);default:return new i(e)}}function h(){if(a||u.length===0)return;var e,t,r,i,s,f,l,p,d=[];a=!0,e=u.shift(),t=e.promise,r=e.loads;for(l=0,p=r.length;l<p;l++)i=r[l],s=i.id,o[s]||(f=c(i),function(e,t,n){var r=t.load().then(function(t){n.result=t,o[e]=n}).catchError(function(e){});d.push(r)}(s,f,i));n.wait(d).then(function(){t.done(),a=!1,h()})}var o={},u=[],a=!1,f={},l={};return{load:function(e){t.isArray(e)||(e=[e]);var r=new n,i=[],s,o,a,f;for(s=0,o=e.length;s<o;s++)a=e[s],typeof a=="string"&&(f=a,a={id:f,src:f}),a.type||(a.type=f.substr(f.lastIndexOf(".")+1)),i.push(a);return u.push({promise:r,loads:i}),h(),r},get:function(e){return o[e].result},getAsyncImage:function(n){var r=e("./AsyncImage"),i=o[n].result;return t.isImage(i)?new r(n):null},remove:function(e){var n=o[e].result;n&&(t.isImage(n)&&n.dispose&&n.dispose(),delete o[e])}}}),define("preload/AsyncImage",["./../var","./LoadQueue"],function(e,t){var n=function(e){this.imageId=e},r=n.prototype;return r.draw=function(n){var r=e.slice(arguments,1),i=t.get(this.imageId);i&&(r.unshift(i),n.drawImage.apply(n,r))},r.dispose=function(){var e=t.get(this.imageId);e&&(t.remove(this.imageId),e.dispose&&e.dispose())},r.reload=function(){},n}),define("preload",["./var","./preload/AsyncImage","./preload/Loader","./preload/ImageLoader","./preload/LoadQueue"],function(e,t,n,r,i){return{AsyncImage:t,Loader:n,ImageLoader:r,LoadQueue:i}}),define("core/Time",[],function(){return{delta:0,now:0,update:function(){var e=Date.now();this.now&&(this.delta=e-this.now),this.now=e},reset:function(){this.delta=0,this.now=0}}}),define("core/time",[],function(){return{delta:0,now:0,update:function(){var e=Date.now();this.now&&(this.delta=e-this.now),this.now=e},reset:function(){this.delta=0,this.now=0}}}),define("util/Tuple",[],function(){var e=function(){this.data={}};return e.prototype={push:function(e,t){this.data[e]=this.data[e]||[],this.data[e].push(t)},get:function(e){return e===undefined?this.data:this.data[e]||[]},sort:function(e,t){return this.data[e].sort(t),this},remove:function(e,t){var n,r,i,s=this.data[e];if(!s)return!1;for(r=0,i=s.length;r<i;r++)if(s[r]===t){n=r;break}return n!==undefined?(s.splice(n,1),!0):!1},clear:function(e){e?this.data[e]=undefined:this.data={}}},e}),define("core/Transform",["./../math/Matrix2D"],function(e){var t=new e,n=function(e){this.x=0,this.y=0,this.regX=0,this.regY=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.skewX=0,this.skewY=0,this.alpha=1,this.gameObject=e.gameObject};return n.prototype={getRoot:function(){var e=this.gameObject;while(e&&e._parent)e=e._parent;return e.transform},localToGlobal:function(e,t){var n=this.getConcatenatedMatrix();return n==null?null:(n.append(1,0,0,1,e,t),{x:n.tx,y:n.ty})},globalToLocal:function(e,t){var n=this.getConcatenatedMatrix();return n==null?null:(n.invert(),n.append(1,0,0,1,e,t),{x:n.tx,y:n.ty})},getConcatenatedMatrix:function(){var e=this;t.identity();while(e!=null)t.prependTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY).prependProperties(e.alpha),e=e.parent;return t},getMatrix:function(){var e=this;return t.identity().appendTransform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY,e.regX,e.regY).appendProperties(e.alpha)},updateContext:function(e){var n,r=this;n=t.identity().appendTransform(r.x,r.y,r.scaleX,r.scaleY,r.rotation,r.skewX,r.skewY,r.regX,r.regY),e.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),e.globalAlpha*=r.alpha},applyTransform:function(e){this.x=e.x,this.y=e.y,this.regX=e.regX,this.regY=e.regY,this.scaleX=e.scaleX,this.scaleY=e.scaleY,this.rotation=e.rotation,this.alpha=e.alpha,this.skewX=e.skewX,this.skewY=e.skewY}},n}),define("core/AbstractGameObject",["require","module","./../var","./../events/EventTarget","./Transform"],function(e,t,n,r,i){var s=function(e){r.apply(this,arguments),this.id=e.id,this.UID=n.uniqueKey(),this.transform=new i({gameObject:this}),this._parent=null,this._children=[],this._childrenMap={}},o=s.prototype;return o.setId=function(e){this._parent&&(delete this._parent._childrenMap[this.id],this._parent._childrenMap[e]=this),this.id=e},o.getParent=function(){return this._parent},o.getPath=function(e){var t=this,n=[];while(t)n.unshift(t.id),t=t._parent;return n.join(e||".")},o.getStage=function(){return e("./Stage").root},o.getChildren=function(){return this._children.slice()},o.sortChildren=function(e){this._children.sort(e)},o.getObjectById=function(e){return this._childrenMap[e]},o.addObject=function(e){this._childrenMap[e.id]=e,this._children.push(e),e._parent=this},o.insertObject=function(e,t){this._childrenMap[e.id]=e,this._children.splice(t,0,e),e._parent=this},o.insertBefore=function(e,t){var n,r,i,s=0;for(n=0,r=this._children.length;n<r;n++){i=this._children[n];if(i===t||i.id===t){s=n;break}}this.insertObject(e,s)},o.insertAfter=function(e,t){var n,r,i,s=this._children.length;for(n=0,r=this._children.length;n<r;n++){i=this._children[n];if(i===t||i.id===t){s=n;break}}this.insertObject(e,s+1)},o.removeObject=function(e){var t=this._children,n=typeof e=="string"?this._childrenMap[e]:e,r=-1,i,s;for(i=0,s=t.length;i<s;i++)if(n===t[i]){r=i,t.splice(r,1);break}return r!==-1&&(delete this._childrenMap[n.id],n._parent=null,n.transform.parent=null),r},o.remove=function(e){this._parent&&this._parent.removeObject(this),this._parent=null},o.removeAll=function(e){this._children=[],this._childrenMap={}},o.findObjectById=function(e){var t,n,r,i=this.getObjectById(e);if(!i){r=this._children;for(t=0,n=r.length;t<n;t++){i=r[t].findObjectById(e);if(i)break}}return i},o.findObjectByPath=function(e){var t,n,r=e.split("."),i=this.findObjectById(r[0]);if(i)for(t=1,n=r.length;t<n;t++){i=i.getObjectById(r[t]);if(!i)return null}return i},n.extend(s,r),s}),define("core/Component",["./../var"],function(e){function t(){this.UID=e.uniqueKey(),this.gameObject=null}var n=t.prototype;return n.setGameObject=function(e){this.gameObject=e},n.initComponent=function(){},n.destroyComponent=function(){},n.on=function(){this.gameObject.addEventListener.apply(this.gameObject,arguments)},n.off=function(){this.gameObject.removeEventListener.apply(this.gameObject,arguments)},n.dispatchEvent=function(e){this.gameObject.dispatchEvent(e)},n.isInstanceof=function(e){return this instanceof e},t}),define("core/Behaviour",["./../var","./Component"],function(e,t){function n(){t.apply(this,arguments),this.enabled=!1}var r=n.prototype;return r.update=function(){},r.lateUpdate=function(){},e.extend(n,t),n}),define("core/Renderer",["./../var","./Component"],function(e,t){function n(){t.apply(this,arguments)}var r=n.prototype;return r.draw=function(e,t){},e.extend(n,t),n}),define("core/HitDelegate",["./../var","./Component"],function(e,t){function n(){t.apply(this,arguments)}var r=n.prototype;return r.testHit=function(e,t){},e.extend(n,t),n}),define("core/events/GameObjectEvent",["./../../var","./../../events/Event"],function(e,t){var n=function(e){t.apply(this,arguments)};return n.INIT="init",n.DESTROY="destroy",e.extend(n,t),n}),define("core/UnityGameObject",["./../var","./../globals","./AbstractGameObject","./Component","./Behaviour","./Renderer","./HitDelegate","./events/GameObjectEvent"],function(e,t,n,r,i,s,o,u){var a=e.createCanvas(1,1),f=a.getContext("2d"),l=function(e){n.apply(this,arguments),this._active=!0,this._visible=!0,this._initialized=!1,this._components=[],this._delayRemoves=[]},c=l.prototype;return c.isActive=function(e){if(e===!1)return this._active;var t=!0,n=this;while(n){t=t&&n._active;if(!t)return!1;n=n._parent}return t},c.setActive=function(e){this._active=e},c.isVisible=function(e){if(e===!1)return this._visible;var t=!0,n=this;while(n){t=t&&n._visible;if(!t)return!1;n=n._parent}return t},c.setVisible=function(e){this._visible=e},c.addComponent=function(e){this._components.push(e),e.setGameObject(this)},c.getComponent=function(e){var t,n,r,i=this._components;for(t=0,n=i.length;t<n;t++){r=i[t];if(r.isInstanceof(e))return r}return null},c.getComponents=function(e){var t,n,r,i=this._components,s=[];for(t=0,n=i.length;t<n;t++)r=i[t],r.isInstanceof(e)&&s.push(r);return s},c.removeComponent=function(e){var t,n,r,i=this._components;for(t=0,n=i.length;t<n;t++){r=i[t];if(r===e){i.splice(t,1),r.setGameObject(null);break}}},c.delayRemoveComponent=function(e){this._delayRemoves.push(e)},c.delayRemoveObject=function(e){this._delayRemoves.push(e)},c.delayRemove=function(){this._parent.delayRemoveObject(this)},c.sendMessage=function(e,t,n){var r,i,s,o,u=this._components;for(r=0,i=u.length;r<i;r++){s=u[r];if(!n||n&&s.isInstanceof(n))o=s[e],o&&o.apply(s,t)}},c.broadcastMessage=function(e,t){var n,r,i,s=this._children;for(n=0,r=s.length;n<r;n++)i=s[n],i.broadcastMessage(e,t);this.sendMessage(e,t)},c.init=function(){var e,n,r,i=this._children;this.sendMessage(t.METHOD_INIT_COMPONENT);for(e=0,n=i.length;e<n;e++)r=i[e],r.init();this._doDelayRemove(),this._initialized=!0,this.dispatchEvent(new u({type:u.INIT,bubbles:!0}))},c.destroy=function(){var e,n,r,i=this._children;for(e=0,n=i.length;e<n;e++)r=i[e],r.destroy();this._doDelayRemove(),this.sendMessage(t.METHOD_DESTROY_COMPONENT),this.dispatchEvent(new u({type:u.DESTROY,bubbles:!0}))},c.update=function(){if(!this._initialized||!this._active)return;var e,n,r,s=this._children;for(e=0,n=s.length;e<n;e++)r=s[e],r.update();this.sendMessage(t.METHOD_UPDATE,null,i),this._doDelayRemove()},c.lateUpdate=function(){if(!this._initialized||!this._active)return;var e,n,r,s=this._children;for(e=0,n=s.length;e<n;e++)r=s[e],r.lateUpdate();this.sendMessage(t.METHOD_LATE_UPDATE,null,i),this._doDelayRemove()},c.draw=function(e,t){if(!this._initialized||!this._active||!this._visible)return;e.save(),this.transform.updateContext(e),this._draw(e,t),e.restore(),this._doDelayRemove()},c.testHit=function(e,t,n){var r=!1,i,u;return!this.isActive(!0)||!this.isVisible(!0)?!1:(i=this.getComponent(o),i?r=i.testHit(e,t):this._cacheCanvas&&this._cached?r=this._cacheContext.getImageData(-this._cacheOffsetX+e,-this._cacheOffsetY+t,1,1).data[3]>1:(f.setTransform(1,0,0,1,-e,-t),n?(u=this.getComponent(s),u?u.draw(f,this.getStage().getVisibleRect()):r=!1):this._draw(f,this.getStage().getVisibleRect()),r=f.getImageData(0,0,1,1).data[3]>1,f.setTransform(1,0,0,1,0,0),f.clearRect(0,0,2,2)),r)},c.getTopObjectUnderPoint=function(e,t){var n,r,i,s;for(n=this._children.length-1;n>=0;n--){r=this._children[n],i=r.getTopObjectUnderPoint(e,t);if(i)return i}return s=this.transform.globalToLocal(e,t),this.testHit(s.x,s.y,!0)?this:null},c._doDelayRemove=function(){var e,t,i;if(this._delayRemoves.length>0){for(e=0,t=this._delayRemoves.length;e<t;e++)i=this._delayRemoves[e],i instanceof n?this.removeObject(i):i instanceof r&&this.removeComponent(i);this._delayRemoves.length=0}},c._draw=function(e,n){var r,i,o,u=this._children;this.sendMessage(t.METHOD_DRAW,arguments,s);for(r=0,i=u.length;r<i;r++)o=u[r],o.draw(e,n)},e.extend(l,n),l}),define("core/Filter",["./../var","./Component"],function(e,t){function n(){t.apply(this,arguments),this.enabled=!1}var r=n.prototype;return r.applyFilter=function(e,t,n,r,i){},e.extend(n,t),n}),define("core/CachableGameObject",["module","./../var","./../globals","./UnityGameObject","./Filter"],function(e,t,n,r,i){var s=function(e){r.apply(this,arguments),this._cacheCanvas=null,this._cacheContext=null,this._cached=!1,this._cacheOffsetX=0,this._cacheOffsetY=0},o=s.prototype;return o.cache=function(e,n,r,i){this._cacheCanvas&&this.uncache(),this._cacheOffsetX=e,this._cacheOffsetY=n,this._cacheCanvas=t.createCanvas(r,i),this._cacheContext=this._cacheCanvas.getContext("2d"),this._cached=!1},o.updateCache=function(e,t){this._cached=!1,this._cacheOffsetX=e||this._cacheOffsetX,this._cacheOffsetY=t||this._cacheOffsetY},o.translateCache=function(e,t){this._cached=!1,this._cacheOffsetX+=e,this._cacheOffsetY+=t},o.uncache=function(){this._cacheCanvas&&(this._cacheContext.dispose&&this._cacheContext.dispose(),this._cacheCanvas.dispose&&this._cacheCanvas.dispose(),this._cacheCanvas=null),this._cached=!1},o._draw=function(e,t){this._cacheCanvas?(this._cached||(this._drawCache(),this._cached=!0),e.drawImage(this._cacheCanvas,0,0)):r.prototype._draw.apply(this,arguments)},o._drawCache=function(e,t){var n=this._cacheContext;n.clearRect(0,0,this._cacheCanvas.width,this._cacheCanvas.height),n=this._cacheContext,n.translate(-this._cacheOffsetX,-this._cacheOffsetY),this._draw(n,t),n.translate(this._cacheOffsetX,this._cacheOffsetY),this._applyFilters(n,0,0,this._cacheCanvas.width,this._cacheCanvas.height)},o._applyFilters=function(e,t,n,r,s){var o,u,a=this.getComponents(i);for(o in a)e.save(),u=a[o],u.applyFilter(e,t,n,r,s),e.restore()},t.extend(s,r),s}),define("core/Stage",["./../var","./CachableGameObject"],function(e,t){var n={x:0,y:0,width:0,height:0},r=function(e){t.apply(this,arguments),this.autoClear=e.autoClear,this.width=e.width,this.height=e.height,this.stageCanvas=e.canvas,this.stageContext=this.stageCanvas.getContext("2d")};r.root=null;var i=r.prototype;return i.tick=function(){this.update(),this.lateUpdate(),this.draw()},i.draw=function(){this.autoClear&&this.stageContext.clearRect(0,0,this.width,this.height),t.prototype.draw.apply(this,[this.stageContext,this.getVisibleRect()])},i.resize=function(e,t){this.stageCanvas.width=e,this.stageCanvas.height=t,this.width=e,this.height=t},i.getVisibleRect=function(){return n.x=-this.transform.x,n.y=-this.transform.y,n.width=this.width,n.height=this.height,n},e.extend(r,t),r}),define("core/Engine",["./time","./../util/Tuple","./Stage"],function(e,t,n){function a(){if(!o){e.reset();return}e.update(),f(),n.root&&n.root.tick(),r(a,u)}function f(){var e,t,n,r,o=s.get(i);if(!o||o.length===0)return;o=[].concat(o);for(e=0,t=o.length;e<t;e++)n=o[e],n.apply(n,arguments)}var r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(e,t){setTimeout(e,t)},i="Engine",s=new t,o=!0,u;return{addListener:function(e){var t;if(e.isStage){t=e;if(t.__engineTick)return;t.__engineTick=function(){t.update(),t.lateUpdate(),t.draw()},e=t.__engineTick}s.push(i,e)},removeListener:function(e){var t;if(e.isStage){t=e;if(!t.__engineTick)return;e=t.__engineTick,t.__engineTick=null}s.remove(i,e)},start:function(e){u=e||10,o=!0,r(a,u)},stop:function(){o=!1},runStep:function(){e.update(),e.delta=u,f()}}}),define("core/Collider",["./../var","./Component"],function(e,t){function n(){t.apply(this,arguments)}var r=n.prototype;return e.extend(n,t),n}),define("core/events/TouchEvent",["./../../var","./../../events/Event"],function(e,t){var n=function(e){t.apply(this,arguments),this.x=e.x,this.y=e.y};return n.TOUCH_START="touchstart",n.TOUCH_END="touchend",n.TOUCH_MOVE="touchmove",n.CLICK="click",e.extend(n,t),n}),define("core/Touch",["./../var/support","./events/TouchEvent"],function(e,t){function o(){var e=n.stageCanvas,t={x:e.offsetLeft,y:e.offsetTop};while(e=e.offsetParent)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function u(e){if(!r)return;var u,a,f,l,c,h,p=e.type;f=o(),e.touches?e.changedTouches&&(h=e.changedTouches[0],l=h.pageX-f.x,c=h.pageY-f.y):(l=e.pageX-f.x,c=e.pageY-f.y),u=n.getTopObjectUnderPoint(l,c),p==="mousedown"?(p=t.TOUCH_START,i=u):p==="mouseup"?(p=t.TOUCH_END,s=u):p==="mousemove"&&(p=t.TOUCH_MOVE),a=new t({type:p,x:l,y:c}),u&&u.dispatchEvent(a),p===t.TOUCH_END&&s&&i===s&&(i=null,s=null,s.dispatchEvent(new t({type:t.CLICK,x:l,y:c})))}var n,r=!0,i,s;return{init:function(t){n=t;if(e.touch)canvas.addEventListener("touchstart",u,!1),canvas.addEventListener("touchend",u,!1),canvas.addEventListener("touchmove",u,!1);else{var r=!1;canvas.addEventListener("mousedown",function(e){r=!0,u(e)},!1),canvas.addEventListener("mouseup",function(e){r=!1,u(e)},!1),canvas.addEventListener("mousemove",function(e){r&&u(e)},!1)}},enable:function(){r=!0},disable:function(){r=!1}}}),define("core",["./core/Time","./core/Engine","./core/AbstractGameObject","./core/UnityGameObject","./core/CachableGameObject","./core/Transform","./core/Component","./core/Behaviour","./core/Collider","./core/Filter","./core/HitDelegate","./core/Renderer","./core/Stage","./core/Touch","./core/events/GameObjectEvent","./core/events/TouchEvent"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m,g=function(e){m=e},y=function(e){var n=new h({id:"wozllajs_Stage",canvas:m.canvas,width:m.width,height:m.height,autoClear:m.autoClear});m.canvas.width=m.width,m.canvas.height=m.height,n.addEventListener(d.INIT,function(t){t.removeListener(),setTimeout(function(){e&&e(n)},1)}),h.root=n,p.init(n),n.init(),t.start()};return{config:g,onStageInit:y,Time:e,Engine:t,AbstractGameObject:n,UnityGameObject:r,CachableGameObject:i,GameObject:i,Transform:s,Component:o,Behaviour:u,Filter:f,HitDelegate:l,Renderer:c,Stage:h,Touch:p,events:{TouchEvent:v,GameObjectEvent:d}}}),define("wozllajs",["./var","./promise","./math","./ajax","./events","./preload","./core"],function(e,t){e.Promise=t;var n=e.slice(arguments,2),r,i,s,o;for(r=0,i=n.length;r<i;r++){s=n[r];for(o in s)e[o]=s[o]}return window.wozllajs=e});